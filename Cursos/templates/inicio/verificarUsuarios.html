{% extends 'layout/layout_admin.html' %}

{% block content %}
  <div class="seccion-formulario">
    <h3 class="titulo-seccion-form">Usuarios sin Verificación</h3>

    <!-- BLOQUE DE MENSAJES -->
    {% if messages %}
      <div class="mensajes">
        {% for message in messages %}
          <div class="alert alert-{% if message.tags == 'error' %}
              
              danger

            {% else %}
              {{ message.tags }}
            {% endif %}">{{ message }}</div>
        {% endfor %}
      </div>
    {% endif %}

    {% for usuario in usuariosSinVerificar %}
      <form class="formulario-ficha" method="post" action="{% url 'verificar_usuario' usuario.idusuario %}" enctype="multipart/form-data" style="display:flex; align-items:center; gap:10px; margin-bottom:10px;">
        {% csrf_token %}
        <input type="text" class="entrada-texto" value="{{ usuario.nombre }}" readonly />
        <!-- Selector de tipo de usuario -->
        <div class="campo-entrada">
          <label for="rol" class="etiqueta-campo">Rol*:</label>
          <select id="rol" name="rol" class="selector-usuario" required>
            <option value="">Seleccione su rol</option>
            <option value="1">Instructor</option>
            <option value="2">Coordinador</option>
            <option value="3">Funcionario</option>
            <option value="4">Administrador</option>
            <option value="5">Curricular</option>
          </select>
        </div>
        <button type="button" class="boton-verificar" onclick="confirmarVerificacion('{{ usuario.nombre }}', this.form)">✔</button>
      </form>
    {% endfor %}

    {% if not usuariosSinVerificar %}
      <p class="sin-usuarios-mensaje">No hay usuarios sin verificar.</p>
    {% endif %}
  </div>

  <!-- Modal de confirmación -->
  <div id="modal-confirmacion" class="modal-confirmacion" style="display: none;">
    <div class="modal-contenido-confirmacion">
      <p id="mensaje-confirmacion"></p>
      <div class="botones-modal">
        <button class="boton-modal boton-confirmar" onclick="confirmar()">Sí, verificar</button>
        <button class="boton-modal boton-cancelar" onclick="cancelar()">Cancelar</button>
      </div>
    </div>
  </div>

  <script>
    let formularioActual = null
    
    function confirmarVerificacion(nombre, form) {
      const modal = document.getElementById('modal-confirmacion')
      const mensaje = document.getElementById('mensaje-confirmacion')
    
      mensaje.textContent = `¿Estás seguro de verificar a ${nombre}?`
      formularioActual = form
      modal.style.display = 'flex'
    }
    
    function confirmar() {
      if (formularioActual) {
        formularioActual.submit()
      }
      cancelar()
    }
    
    function cancelar() {
      const modal = document.getElementById('modal-confirmacion')
      modal.style.display = 'none'
      formularioActual = null
    }
  </script>
{% endblock %}
